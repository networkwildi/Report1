---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

############################
Code Snippets
glimpse(student_clean)
glimpse(professors_clean)
rlang::last_error()
rlang::last_trace()
class(survey_clean)

#############################

# The data
Under the Resources tab of this unit, you will find the file survey.csv. 
Download this file and save it in your working directory.
This file contains the data collected from a survey of participants at a conference in the Netherlands. 

### The participants were asked the following questions:

What university do you come from?
What is your position?
How many employees are there in your research group?
How many Ph.D. students are there in your research group?
How many postdocs are there in your research group?
How many professors are there in your research group?
The answers are stored in the file survey.csv.

## Exercises
### Part 1
Load the data and answer the following questions:

```{r echo=FALSE, error=FALSE, include=FALSE}

library(readr)

survey_source<- read_csv("survey.csv")
survey_roname <-  rownames_to_column(survey_source,"question")
survey <- select(survey_roname,(-X1))
survey_clean <- clean_names(survey)
# survey_clean



```

How many survey participants were there?
What are the data types of each column?
What are the top 3 universities with the most survey participants?

```{r}

library(tidyr)
library(tibble)

# How many survey participants were there?
# I think I have a problem understanding the meaning of this question. Do you want us to give you 30 as a response or is it something else ?
# Yes, if this is the number of participants to the survey.

survey_participants <- survey_clean %>% 
  mutate(numb_of_particip = number_of_employees + number_of_ph_d_students + number_of_postdocs + number_of_professors) %>% 
select(university, numb_of_particip) %>% 
as_tibble()

ban_survey_participant <- c("How many survey participants were there?")
result_paricipants <- c(ban_survey_participant, survey_participants)
print(result_paricipants)


#print(survey_participants, "How many survey participants were there?") 


##   done ##


```
# What are the data types of each column?
```{r}
print("What are the data types of each column?")

glimpse(survey_clean)
print("or more detailed")
str(survey_clean)

##  Done  ##

```
```{r}

library(dplyr)

# What are the top 3 universities with the most survey participants?

survey_participants %>% 
  arrange(desc(numb_of_particip)) %>% 
  top_n(3)


## Done ##

```

# Part 2
### Obtain a horizontal bar graph of the number of survey participants for the different positions given in the column Position.
### (Thanks for flagging the needed clarification in Part 2, I have updated the definition of the groups (1-10, 11-20…).)

```{r}


library(dplyr)
library(tibble)
library(ggplot2)
library(tidyr)
library(GGally)
# data()

survey_position <- survey_clean %>% select(position) %>% 
as.tibble(survey_position)
str(survey_position)

survey_positions <- (survey_clean %>%  select(position)) %>% 
tibble::as_tibble(survey_positions)
str(survey_positions)

survey_parts <- (survey_clean %>%  select(number_of_employees,number_of_ph_d_students,number_of_postdocs,  number_of_professors)) %>% 
as.tibble(survey_parts) 
str(survey_parts)

survey_pos_parts  <- (survey_clean %>% select(position, number_of_employees,number_of_ph_d_students,number_of_postdocs,  number_of_professors)) %>% as_tibble(survey_pos_parts)
str(survey_pos_parts)
as_data_frame(survey_pos_parts)

###   Data

# example pot

sales_data_xls %>% 
  ggplot(aes(x=quantity_ordered, y=sales))+
  geom_point(mapping = aes(color=dealsize), alpha=0.3)+
  geom_point(data=filter(sales_data_xls, territory=="APAC",
                         status=="Disputed"),
             shape=1, size=4, stroke=2, color="blue")
```

```{r}
survey_clean %>% 
  group_by(position) %>% 
  ggplot(aes(x=number_of_employees, y=position))+
  geom_point(mapping = aes(color=university), alpha=0.3)
  # geom_point(data=filter(survey_clean, territory=="Large",
    #                     sizes=="Small"),
     #        shape=1, size=4, stroke=2, color="blue")

  
```

str()
plot(survey_parts
names(survey_clean)
rlang::last_error()
rlang::last_trace()


# Part 3
### There is a column (named Sizes) in the dataset that is supposed to group the data in the column Number of employees in the following bins:

Small (0 to 10)
Medium (11 to 20)
Large (21 to 100)
Extra large (over 100)
Unfortunately, somebody made mistakes in that column…

Recreate this column correctly, then plot a bar chart with {ggplot2} of the number of values in each of the bins.



```{r}

library(readr)
library(tibble)
library(tidyselect)
library(tidyr)
library(dplyr)
library(stringr)
library(janitor)
library(ggplot2)
library(tidyverse)

employees <- survey_clean %>% 
  select(number_of_employees)

# small     # (0 to 10)
small <-employees %>% 
  filter(number_of_employees <=10) %>% 
    mutate(sizes = ("Small (0 to 10)"))
small <-rename(small, small = number_of_employees)

# medium  # Medium (11 to 20)
medium <-employees %>% 
  filter(number_of_employees >10, number_of_employees <=20) %>% 
  mutate(sizes = ("Medium (11 to 20"))
medium <-rename(medium, medium = number_of_employees)


# large # (21 to 100)
large <- employees %>% 
  filter(number_of_employees >20, number_of_employees <=100) %>% 
  mutate(sizes = ("Large (21 to 100"))
large <- rename(large, large = number_of_employees)

# extra_large   #(over 100)
extra_large <- employees %>% 
  filter(number_of_employees >100) %>% 
  mutate(sizes = ("Extra Large (over 100"))
extra_large <- rename(extra_large, extra_large = number_of_employees)

sizes_ordered <- bind_rows(small,medium,large, extra_large)
sog <- sizes_ordered %>% group_by(sizes)
sog

# employees_o <- add_column(small_o, medium_o, large_o, extra_large_o)

small_o <- select(small,small)
medium_o <- select(medium, medium)
large_o <- select(large,large)
extra_large_o <- select(extra_large, extra_large)


emg <-c(small_o, medium_o, large_o, extra_large_o)
sg <- c(select(sog,sizes))

emg_o <- mutate(small_o, medium_o, large_o, extra_large_o)

plot(small_o)


sog %>%
  ggplot(aes(x=sizes, y=number_of_employees))+
  geom_bar(aes(y = stat (count / max(count))))

# Recreate this column correctly, then plot a bar chart with {ggplot2} of the number of values in each of the bins.

#################             D O N E     ###############

medium


```


# Part 4
### Obtain a stacked horizontal bar plot with {ggplot2} that gives the percentage of employees that are Ph.D. students, postdocs and professors for each research group. Use a custom theme.

### We have not covered stacked horizontal bar plot, so you will have to study the documentation, and/or some blog posts. 
### There is also a great book about {ggplot2} recipes that I recommend you check out: The hitchhiker's guide to ggplot2. 
### The book is pay-as-you-want, so select Package "The book" and choose a number from 0 and 30 dollars.
## (Regarding part 4, you can consider that each student is in a different research group.)


```{r}

library(tidyverse)
survey_clean %>% 
    filter(position == ("PhD Student")) %>% 
      group_by(university)

survey_clean %>%
  arrange(university) %>% 
  filter(position == ("PhD Student"))
summarise(university = sum(number_of_employees))

```
